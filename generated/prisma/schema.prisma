generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  ADMIN_ASSISTANT
  DIVISION_CLERK
  DIVISION_HEAD
  SECTION_HEAD
  PROVINCIAL_ENGR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum Sex {
  MALE
  FEMALE
}

enum ModeOfImplementation {
  BY_ADMINISTRATION
  BY_CONTRACT
}

enum SourceOfFund {
  GENERAL_FUND
  SEF
  TRUST_FUND
  TWENTY_PERCENT_DEV_FUND
  AID
  LOAN
  OTHERS
}

enum District {
  DISTRICT_I
  DISTRICT_II
}

enum ProjectSubType {
  WATER_SYSTEMS
  GOVERNMENT_BUILDINGS
  ELECTRIFICATION
  RESPONSE_CAMP_MGMT
  SUPPLEMENTAL_BUDGET_2
  PARK_AND_DEVELOPMENT
  DOH
  PROVINCIAL_GOVT_OFFICE
}

enum ProjectStatus {
  NOT_YET_STARTED
  ON_GOING
  COMPLETED
  SUSPENDED
}

enum DocumentType {
  POW
  PURCHASE_REQUEST
}

enum DocumentStatus {
  DRAFT
  FOR_REVIEW
  REVISION
  RELEASED
}

model User {
  id            String        @id @default(cuid())
  name          String?
  email         String        @unique
  password      String
  role          UserRole      @default(ADMIN)
  employeeId    String?       @unique
  designation   String?
  division      String?
  sex           Sex?
  status        UserStatus    @default(PENDING)
  emailVerified DateTime?
  image         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  posts         Post[]
  projects      Project[]
  sessions      UserSession[]
  documents     Document[]
}

model UserSession {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  expiresAt  DateTime
  lastActive DateTime @default(now())

  @@index([userId])
  @@index([expiresAt])
}

model Project {
  id                     String               @id @default(cuid())
  projectCode            String               @unique
  title                  String
  subType                ProjectSubType?
  modeOfImplementation   ModeOfImplementation
  locationImplementation District
  sourceOfFund           SourceOfFund
  contractCost           Float                @default(0)
  projectEngineer        String?
  dateStarted            DateTime?
  targetCompletionDate   DateTime?
  duration               Int                  @default(0)
  revisedCompletionDate  DateTime?
  dateCompleted          DateTime?
  daysSuspended          Int                  @default(0)
  daysExtended           Int                  @default(0)
  numFemale              Int                  @default(0)
  numMale                Int                  @default(0)
  numPersons             Int                  @default(0)
  numManDays             Int                  @default(0)
  district               District?
  cityMunicipality       String?
  barangay               String?
  sitio                  String?
  description            String?
  status                 ProjectStatus        @default(NOT_YET_STARTED)
  createdBy              User                 @relation(fields: [createdById], references: [id])
  createdById            String
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt

  @@index([title])
  @@index([status])
  @@index([createdById])
}

model Document {
  id           String         @id @default(cuid())
  documentCode String         @unique
  type         DocumentType
  title        String
  description  String?
  status       DocumentStatus @default(DRAFT)

  filePath String?
  fileName String?
  fileSize Int?

  amount  Float?
  purpose String?

  district   District
  projectRef String?

  releasedAt DateTime?
  releasedTo String?

  createdBy   User     @relation(fields: [createdById], references: [id])
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([district])
  @@index([createdById])
}

model Post {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdBy   User   @relation(fields: [createdById], references: [id])
  createdById String

  @@index([name])
}
